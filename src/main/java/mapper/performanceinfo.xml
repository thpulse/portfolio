<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kitri.performanceinfo">
	<insert id="Add_performance" parameterType="perform">
		insert into performance values(#{prfid},#{prfnm},#{prfpdfrom},#{prfpdto},#{plcid},#{prfcast},#{prfcrew},#{prfruntime},#{prfage},#{tckprice},#{poster},#{story},#{genre},#{prfstate},#{openrun},#{prfdaytime})
	</insert>
	<insert id="Add_performance_sogaeimgs" parameterType="performsogae">
		insert into performance_sogaeimg values(#{prfid},#{styurl})
	</insert>
	<select id="Total_performance" resultType="perform" parameterType="perform">
		select * from performance
		<if test="genre==null">
		<![CDATA[
			where to_date(substr(prfpdto,1,4)||substr(prfpdto,6,2)||substr(prfpdto,9,2))<=(sysdate+30)
				and to_date(substr(prfpdto,1,4)||substr(prfpdto,6,2)||substr(prfpdto,9,2))>=sysdate
		]]>
		</if>
		<if test="genre!=null">
		<![CDATA[
			where genre=#{genre}
				and to_date(substr(prfpdto,1,4)||substr(prfpdto,6,2)||substr(prfpdto,9,2))<=(sysdate+30)
				and to_date(substr(prfpdto,1,4)||substr(prfpdto,6,2)||substr(prfpdto,9,2))>=sysdate
		]]>
		</if>
	</select>
	<select id="Performance_Info" resultType="perform" parameterType="perform">
		select prf.*,plc.plcnm
		from performance prf, prf_place plc
		where prf.prfid=#{prfid} and prf.plcid = plc.plcid
	</select>
	<select id="PerformanceImg_Info" resultType="performsogae" parameterType="performsogae">
		select * from performance_sogaeimg where prfid=#{prfid} order by styurl asc
	</select>
	<select id="Identify_id" resultType="Int" parameterType="String">
		select prfid from performance_sogaeimg where prfid=#{prfid}
	</select>
</mapper>